<!DOCTYPE html>
<html>
<head>
    <title>DefectTrendProdVsTest</title>

    <script type="text/javascript" src="/apps/2.0rc1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("ProdVsTestCalculator",{extend:"Rally.data.lookback.calculator.TimeSeriesCalculator",getMetrics:function(){return[{field:"Environment",as:"Prod",f:"filteredCount",filterField:"Environment",filterValues:["Production"],display:"column"},{field:"Environment",as:"Test",f:"filteredCount",filterField:"Environment",filterValues:["Test"],display:"column"}]}});
                Ext.define("CustomApp",{extend:"Rally.app.App",componentCls:"app",launch:function(){this.snapshotStore=Ext.create("Rally.data.lookback.SnapshotStore",{listeners:{load:function(store,data,success){this._processData(store,data,success)},scope:this},fetch:["Name","Environment","OpenedDate","Project"],hydrate:["Environment"],filters:[{property:"_ProjectHierarchy",operator:"=",value:this.getContext().getProject().ObjectID},{property:"_TypeHierarchy",operator:"=",value:"Defect"},{property:"Resolution",operator:"=",value:"Duplicate"},{property:"_ValidFrom",operator:"=",value:{$gte:"2010-02-01TZ",$lte:"current"}}]}),this.snapshotStore.load()},_processData:function(store,data,success){console.log(data.length),Ext.Array.each(data,function(item){console.log(item.data.Environment+"	"+item.data.OpenedDate+"	"+item.data.Project+"	"+item.data.Name)}),this.calculator=Ext.create("ProdVsTestCalculator",{}),this.calculator.prepareChartData(store),this.chartData=this.calculator.prepareChartData(this.loadedStores)}});

            Rally.launchApp('CustomApp', {
                name:"DefectTrendProdVsTest",
	            parentRepos:""
            });

        });
    </script>


    <style type="text/css">
        .app {
     /* Add app styles here */
}

    </style>
</head>
<body></body>
</html>
